<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://wlieberz.github.io/2021-02-14-sudo-vulnerability-CVE-2021-3156/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>CVE-2021-3156 "Baron Samedit" - checking hosts - Blog::William_Lieberz</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "CVE-2021-3156 \"Baron Samedit\" - checking hosts";
        var mkdocs_page_input_path = "2021-02-14-sudo-vulnerability-CVE-2021-3156.md";
        var mkdocs_page_url = "/2021-02-14-sudo-vulnerability-CVE-2021-3156/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Blog::William_Lieberz
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Rust-Learning-Resources/">Rust Learning Resources</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../2021-02-21-Install-Bitwarden-appimage-on-KDE-distro/">Installing Bitwarden via AppImage on a KDE Distro</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../2021-02-15-sudo-vulnerability-CVE-2021-3156-rhel5-patching/">CVE-2021-3156 "Baron Samedit" - patching RHEL-7 & RHEL-5 hosts</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">CVE-2021-3156 "Baron Samedit" - checking hosts</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#background">Background</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ansible-playbook-usage">Ansible Playbook Usage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ansible-playbook-output">Ansible Playbook Output</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Blog::William_Lieberz</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>CVE-2021-3156 "Baron Samedit" - checking hosts</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cve-2021-3156-baron-samedit-sudo-vulnerability-checking-hosts">CVE-2021-3156 "Baron Samedit" sudo vulnerability - checking hosts</h1>
<p><strong>Date:</strong> 2021-02-14</p>
<p><strong>Categories:</strong>
<code>sudo, CVE-2021-3156, Baron Samedit, security, linux, Ansible</code></p>
<h2 id="background">Background</h2>
<p>Hopefully you are already certain all Linux systems you maintain have been patched to remediate the recent nasty sudo <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-3156">vulnerability</a>, but sometimes it is nice to do yet another sweep through the environment to verify there are no lingering unpatched hosts. </p>
<p>I <a href="https://github.com/wlieberz/ansible/blob/master/playbooks/check-sudo-vuln-CVE-2021-3156.yml">wrote</a> a quick Ansible playbook to check if a host is vulnerable or patched.</p>
<h2 id="ansible-playbook-usage">Ansible Playbook Usage</h2>
<p>You can run the playbook like this:</p>
<pre><code class="language-sh">anisble-playbook -K -i test-inventory check-sudo-vuln-CVE-2021-3156.yml -e target=testing
</code></pre>
<p>The <code>-K</code> is to "Prompt for the password to use with sudo, if any", if you have passwordless sudo for your account on your remote servers, you can omit this flag.</p>
<p>The <code>-i</code> is to allow you to point to a particular Anisble inventory file. I'm using one called "test-inventory" for purposes of...testing.</p>
<p>The <code>-e</code> is to pass an extra variable where we define the variable "target" as being equal to "testing". The "testing" target is a host group defined in the inventory file.</p>
<p>The simple test-inventory file looks like this:</p>
<pre><code class="language-ini">[testing]
host01
host02
</code></pre>
<h2 id="ansible-playbook-output">Ansible Playbook Output</h2>
<p>Running the playbook will produce output similar to:</p>
<pre><code>TASK [Show Vulnerable Hosts] ********************************
skipping: [host01]
ok: [host02] =&gt; {
   &quot;msg&quot;: &quot;VULNERABLE: host02&quot;
}
</code></pre>
<p>Any host which is patched will be skipped by the "Show Vulnerable Hosts" task. Any vulnerable host will be logged with the message "VULNERABLE: $hostName".</p>
<p>It would be nicer if there was a way to get the output of vulnerable hosts to not show "ok" but I have not found a good way to change that in Ansible. Basically, the task to "show vulnerable hosts" succeeded, so that is why we see "ok" in the playbook output. As a workaround, I tried setting the task to always fail and ignore errors (so execution of the playbook doesn't stop), which flags the entire task as red, but the output is more cluttered with debug information so I opted not to use that method.</p>
<p>Hopefully this is helpful to someone!</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../2021-02-15-sudo-vulnerability-CVE-2021-3156-rhel5-patching/" class="btn btn-neutral float-left" title="CVE-2021-3156 "Baron Samedit" - patching RHEL-7 & RHEL-5 hosts"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../2021-02-15-sudo-vulnerability-CVE-2021-3156-rhel5-patching/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
